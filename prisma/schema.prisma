// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
  output   = "./generated/prisma"
}

datasource db {
  provider = "postgresql"
}

enum SubmissionStatus {
  pending
  approved
  rejected
}

model Admin {
  id            String    @id @default(uuid())
  email         String    @unique
  name          String?
  passwordHash  String?   @map("password_hash")
  createdAt     DateTime  @default(now()) @map("created_at")
  updatedAt     DateTime  @updatedAt @map("updated_at")

  @@map("admins")
}

// Add this to your existing schema.prisma

model Article {
  id             String    @id @default(uuid())
  sanityId       String    @unique @map("sanity_id")
  type           String
  title          String
  slug           String    @unique
  author         String?
  isPost         Boolean   @map("is_post")
  visibility     String    @default("private") // 'public' or 'private'
  isEditorsPick  Boolean   @default(false) @map("is_editors_pick")
  isFeaturedOpinion Boolean   @default(false) @map("is_featured_opinion")
  lastSyncedAt   DateTime  @default(now()) @map("last_synced_at")
  createdAt      DateTime  @default(now()) @map("created_at")

  @@map("articles")
}

model Community {
  id            String    @id @default(uuid())
  name          String
  slug          String    @unique
  description   String?
  logoUrl       String?   @map("logo_url")
  contactEmail  String?   @map("contact_email")
  createdAt     DateTime  @default(now()) @map("created_at")
  updatedAt     DateTime  @updatedAt @map("updated_at")

  submissions   Submission[]

  @@map("communities")
}

model Submission {
  id              String    @id @default(uuid())
  communityId     String    @map("community_id")
  authorName      String    @map("author_name")
  authorContact   String    @map("author_contact")
  submissionType  String    @map("submission_type") // 'news', 'event', 'announcement'
  title           String
  content         String
  eventDate       DateTime? @map("event_date") // Only for events
  mediaUrls       String?   @map("media_urls") // JSON array stored as string
  status          String    @default("pending") // 'pending', 'reviewed', 'rejected'
  reviewedAt      DateTime? @map("reviewed_at")
  reviewedBy      String?   @map("reviewed_by") // Admin ID
  createdAt       DateTime  @default(now()) @map("created_at")

  community       Community @relation(fields: [communityId], references: [id], onDelete: Cascade)

  @@index([communityId])
  @@index([status])
  @@index([submissionType])
  @@map("submissions")
}